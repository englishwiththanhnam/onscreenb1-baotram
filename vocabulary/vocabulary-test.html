<!DOCTYPE html> 
<html lang="vi"> 
<head> 
 Â  Â <meta charset="UTF-8"> 
 Â  Â <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
 Â  Â <title>Há»c Tá»« Vá»±ng - Lá»™ TrÃ¬nh ThÃ­ch á»¨ng</title> 
 Â  Â <script src="https://cdn.tailwindcss.com"></script> 
 Â  Â <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
 Â  Â <link rel="preconnect" href="https://fonts.googleapis.com"> 
 Â  Â <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
 Â  Â <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet"> 
 Â  Â 
 Â  Â <script type="module"> 
 Â  Â  Â  Â import { Renderer, Camera, Transform, Program, Geometry, Mesh } from 'https://cdn.skypack.dev/ogl'; 
 Â  Â  Â  Â window.OGL = { Renderer, Camera, Transform, Program, Geometry, Mesh }; 
 Â  Â </script> 

 Â  Â <style> 
 Â  Â  Â  Â :root { 
 Â  Â  Â  Â  Â  Â --bg-dark: #0f172a; 
 Â  Â  Â  Â  Â  Â --text-light: #e2e8f0; 
 Â  Â  Â  Â  Â  Â --text-secondary: #94a3b8; 
 Â  Â  Â  Â  Â  Â --glass-bg: rgba(30, 41, 59, 0.5); 
 Â  Â  Â  Â  Â  Â --glass-border: rgba(255, 255, 255, 0.1); 
 Â  Â  Â  Â  Â  Â --primary-accent: #8b5cf6; 
 Â  Â  Â  Â  Â  Â --primary-accent-glow: rgba(139, 92, 246, 0.5); 
 Â  Â  Â  Â  Â  Â --correct-color: #22c55e; 
 Â  Â  Â  Â  Â  Â --incorrect-color: #ef4444; 
 Â  Â  Â  Â } 
 Â  Â  Â  Â * { margin: 0; padding: 0; box-sizing: border-box; } 
 Â  Â  Â  Â html { scroll-behavior: smooth; } 
 Â  Â  Â  Â body { 
 Â  Â  Â  Â  Â  Â font-family: 'Be Vietnam Pro', sans-serif; 
 Â  Â  Â  Â  Â  Â background-color: var(--bg-dark); 
 Â  Â  Â  Â  Â  Â color: var(--text-light); 
 Â  Â  Â  Â  Â  Â overflow-x: hidden; 
 Â  Â  Â  Â  Â  Â overflow-y: auto; 
 Â  Â  Â  Â } 
 Â  Â  Â  Â 
 Â  Â  Â  Â .background-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; overflow: hidden; } 
 Â  Â  Â  Â #ogl-canvas-back { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } 
 Â  Â  Â  Â .shape { position: absolute; border-radius: 50%; filter: blur(150px); opacity: 0.3; } 
 Â  Â  Â  Â .shape1 { width: 40vw; height: 40vw; max-width: 500px; max-height: 500px; background: #a855f7; top: -15%; left: -10%; animation: float 28s infinite alternate ease-in-out; } 
 Â  Â  Â  Â .shape2 { width: 35vw; height: 35vw; max-width: 450px; max-height: 450px; background: #22d3ee; bottom: -15%; right: -10%; animation: float 32s infinite alternate ease-in-out; } 
 Â  Â  Â  Â @keyframes float { from { transform: translateY(20px) rotate(0deg); } to { transform: translateY(-20px) rotate(15deg); } } 

 Â  Â  Â  Â .fade-in { animation: fadeIn 0.5s ease-in-out forwards; } 
 Â  Â  Â  Â @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } 
 Â  Â  Â  Â .glass-panel { background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 24px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); } 
 Â  Â  Â  Â .cta-btn { 
 Â  Â  Â  Â  Â  Â position: relative; overflow: hidden; display: inline-flex; align-items: center; justify-content: center; gap: 12px; 
 Â  Â  Â  Â  Â  Â background: linear-gradient(90deg, #8b5cf6, #6d28d9); font-family: 'Be Vietnam Pro', sans-serif; font-weight: 600; font-size: 16px; 
 Â  Â  Â  Â  Â  Â padding: 12px 24px; border-radius: 99px; border: none; cursor: pointer; text-decoration: none; color: rgba(255,255,255,0.9); 
 Â  Â  Â  Â  Â  Â box-shadow: 0 10px 30px -10px var(--primary-accent-glow); transition: all 0.3s ease; 
 Â  Â  Â  Â } 
 Â  Â  Â  Â .cta-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; } 
 Â  Â  Â  Â .cta-btn.secondary { background: transparent; border: 2px solid #5c5f89; box-shadow: none; color: #a2a6c3; } 
 Â  Â  Â  Â .cta-btn.danger { background: transparent; border: 2px solid var(--incorrect-color); color: var(--incorrect-color); } 
 Â  Â  Â  Â .progress-track { background: rgba(255, 255, 255, 0.1); border-radius: 9999px; height: 10px; overflow: hidden; border: 1px solid var(--glass-border); } 
 Â  Â  Â  Â .progress-fill { background: linear-gradient(90deg, #d8b4fe 0%, #a855f7 100%); height: 100%; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1); } 
 Â  Â  Â  Â .answer-option { display: block; width: 100%; padding: 1rem; border-radius: 16px; text-align: left; font-weight: 500; background: transparent; border: 2px solid #5c5f89; color: #a2a6c3; transition: all 0.2s ease; } 
 Â  Â  Â  Â .answer-option:not(.disabled):hover { border-color: var(--primary-accent); background-color: rgba(139, 92, 246, 0.1); } 
 Â  Â  Â  Â .answer-option.disabled { cursor: not-allowed; opacity: 0.6; } 
 Â  Â  Â  Â .answer-option.selected.correct { border-color: var(--correct-color); background: rgba(34, 197, 94, 0.2); color: #bbf7d0; } 
 Â  Â  Â  Â .answer-option.selected.incorrect { border-color: var(--incorrect-color); background: rgba(239, 68, 68, 0.2); color: #fecaca; } 
 Â  Â  Â  Â .answer-option.correct-answer { border-color: var(--correct-color); background: rgba(34, 197, 94, 0.1); } 
 Â  Â  Â  Â .text-input-styled { background: rgba(55, 65, 81, 0.5); border: 1px solid var(--glass-border); border-radius: 12px; padding: 0.75rem 1rem; color: var(--text-light); caret-color: var(--primary-accent); } 
 Â  Â  Â  Â .text-input-styled:focus { outline: none; border-color: var(--primary-accent); box-shadow: 0 0 0 3px var(--primary-accent-glow); } 
 Â  Â  Â  Â .level-card { border: 2px solid var(--glass-border); text-align: center; transition: all 0.3s ease; } 
 Â  Â  Â  Â .level-card.locked { opacity: 0.5; filter: grayscale(80%); } 
 Â  Â  Â  Â .level-card.locked .cta-btn { pointer-events: none; } 
 Â  Â  Â  Â .level-card.passed { border-color: var(--correct-color); background: rgba(34, 197, 94, 0.1); } 
 Â  Â  Â  Â .level-card.active { border-color: var(--primary-accent); box-shadow: 0 0 20px var(--primary-accent-glow); transform: translateY(-5px); } 
 Â  Â  Â  Â .level-card.unlocked:not(.active):hover { border-color: var(--primary-accent); transform: translateY(-5px); } 
 Â  Â  Â  Â .report-actions { border-top: 1px solid var(--glass-border); margin-top: 1.5rem; padding-top: 1.5rem; display: flex; gap: 0.75rem; z-index: 10; } 
 Â  Â  Â  Â .report-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--text-secondary); padding: 0.5rem 0.75rem; border-radius: 8px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s ease; } 
 Â  Â  Â  Â .report-category-group label { display: block; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); cursor: pointer; transition: all 0.2s ease; } 
 Â  Â  Â  Â .report-category-group input:checked + label { background: var(--primary-accent); border-color: var(--primary-accent-glow); color: white; } 
 Â  Â  Â  Â .report-category-group input { display: none; } 
 Â  Â  Â  Â #report-comment-input { width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: var(--text-light); margin-top: 1rem; resize: vertical; } 
 Â  Â  Â  Â 
 Â  Â  Â  Â /* Flashcard Styles */ 
 Â  Â  Â  Â .flashcard { perspective: 1500px; } 
 Â  Â  Â  Â .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.7s; transform-style: preserve-3d; } 
 Â  Â  Â  Â .flashcard.is-flipped .flashcard-inner { transform: rotateY(180deg); } 
 Â  Â  Â  Â .flashcard-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 24px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); } 
 Â  Â  Â  Â .flashcard-back { transform: rotateY(180deg); } 
 Â  Â  Â  Â .flashcard-word { font-family: 'Be Vietnam Pro', sans-serif; font-size: clamp(2rem, 8vw, 4rem); font-weight: 700; } 
 Â  Â  Â  Â .flashcard-pronunciation { font-family: 'Be Vietnam Pro', sans-serif; color: var(--text-secondary); margin-top: 0.5rem; } 
 Â  Â  Â  Â .flashcard-meaning { font-family: 'Be Vietnam Pro', sans-serif; font-size: clamp(1.5rem, 6vw, 2.5rem); font-weight: 600; } 
 Â  Â  Â  Â .flashcard-example { font-style: italic; color: var(--text-secondary); margin-top: 1.5rem; } 
 Â  Â  Â  Â .audio-btn { position: absolute; top: 1.5rem; right: 1.5rem; width: 44px; height: 44px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.1); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; z-index: 10; } 

 Â  Â  Â  Â /* Guide Modal Styles */ 
 Â  Â  Â  Â .guide-section h3 { font-family: 'Be Vietnam Pro', sans-serif; font-size: 1.5rem; font-weight: 700; color: var(--primary-accent); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--primary-accent); } 
 Â  Â  Â  Â .guide-rule { background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 12px; border-left: 4px solid var(--primary-accent); } 
 Â  Â  Â  Â .task-example-card { background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem; } 
 Â  Â </style> 
</head> 
<body> 
 Â  Â <div class="background-layer"> 
 Â  Â  Â  Â <div class="shape shape1"></div> 
 Â  Â  Â  Â <div class="shape shape2"></div> 
 Â  Â  Â  Â <div id="ogl-canvas-back"></div> 
 Â  Â </div> 
 Â  Â 
 Â  Â <div id="loader-overlay" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex flex-col items-center justify-center z-50"> 
 Â  Â  Â  Â <div class="w-16 h-16 border-4 border-t-violet-500 border-gray-600 rounded-full animate-spin"></div> 
 Â  Â  Â  Â <p id="loader-text" class="text-lg font-semibold text-white mt-4">Äang táº£i dá»¯ liá»‡u...</p> 
 Â  Â </div> 
 Â  Â <div id="modal-container"></div> 
 Â  Â 
 Â  Â <div id="app-container" class="max-w-7xl mx-auto p-4 sm:p-8"> 
 Â  Â  Â  Â <header id="app-header" class="mb-8"></header> 
 Â  Â  Â  Â <main id="app-main"></main> 
 Â  Â </div> 

 Â  Â <script type="module"> 
 Â  Â  Â  Â // --- Firebase Imports (UPDATED) --- 
 Â  Â  Â  Â import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"; 
 Â  Â  Â  Â import { getFirestore, doc, getDoc, updateDoc, runTransaction, arrayUnion, serverTimestamp, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"; 

 Â  Â  Â  Â // Background Animation 
 Â  Â  Â  Â if (window.OGL) { 
 Â  Â  Â  Â  Â  Â const { Renderer, Camera, Program, Geometry, Mesh, Transform } = window.OGL; 
 Â  Â  Â  Â  Â  Â const container = document.getElementById('ogl-canvas-back'); 
 Â  Â  Â  Â  Â  Â if (container) { 
 Â  Â  Â  Â  Â  Â  Â  Â const renderer = new Renderer({ dpr: 2, alpha: true }); 
 Â  Â  Â  Â  Â  Â  Â  Â const gl = renderer.gl; 
 Â  Â  Â  Â  Â  Â  Â  Â container.appendChild(gl.canvas); 
 Â  Â  Â  Â  Â  Â  Â  Â const camera = new Camera(gl, { fov: 15, near: 1, far: 100 }); 
 Â  Â  Â  Â  Â  Â  Â  Â camera.position.set(0, 0, 25); 
 Â  Â  Â  Â  Â  Â  Â  Â const scene = new Transform(); 
 Â  Â  Â  Â  Â  Â  Â  Â const program = new Program(gl, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â vertex: `attribute vec3 position;attribute vec4 random;attribute vec3 color;uniform mat4 modelMatrix;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform float uTime;uniform float uSpread;uniform float uBaseSize;varying vec4 vRandom;varying vec3 vColor;void main(){vRandom=random;vColor=color;vec3 pos=position*uSpread;vec4 mPos=modelMatrix*vec4(pos,1.);float t=uTime*.1;mPos.x+=sin(t*random.z+6.28*random.w)*mix(.1,1.5,random.x);mPos.y+=sin(t*random.y+6.28*random.x)*mix(.1,1.5,random.w);mPos.z+=cos(t*random.w+6.28*random.y)*mix(.1,1.5,random.z);vec4 mvPos=viewMatrix*mPos;gl_PointSize=uBaseSize/-mvPos.z;gl_Position=projectionMatrix*mvPos;}`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â fragment: `precision highp float;varying vec3 vColor;void main(){vec2 uv=gl_PointCoord.xy;float d=length(uv-vec2(.5));float glow=smoothstep(.5,0.,d)*.3;float core=smoothstep(.2,.18,d);float alpha=max(core,glow);if(alpha<.01)discard;vec3 finalColor=vColor+vColor*pow(glow,2.)*2.;gl_FragColor=vec4(finalColor,alpha);}`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â uniforms: { uTime: { value: 0 }, uSpread: { value: 10 }, uBaseSize: { value: 350 } }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â transparent: true, depthTest: false 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â const count = 200; 
 Â  Â  Â  Â  Â  Â  Â  Â const positions = new Float32Array(count * 3); 
 Â  Â  Â  Â  Â  Â  Â  Â const randoms = new Float32Array(count * 4); 
 Â  Â  Â  Â  Â  Â  Â  Â const colors = new Float32Array(count * 3); 
 Â  Â  Â  Â  Â  Â  Â  Â const palette = ['#a855f7', '#8b5cf6', '#22d3ee', '#f59e0b']; 
 Â  Â  Â  Â  Â  Â  Â  Â const hexToRgb = (h) => { const r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h); return r ? [parseInt(r[1], 16)/255, parseInt(r[2], 16)/255, parseInt(r[3], 16)/255] : [0,0,0]; }; 
 Â  Â  Â  Â  Â  Â  Â  Â for (let i = 0; i < count; i++) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const z = (Math.random() - 0.5) * 30; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â positions.set([(Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30, z], i * 3); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â randoms.set([Math.random(), Math.random(), Math.random(), Math.random()], i * 4); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â colors.set(hexToRgb(palette[Math.floor(Math.random() * palette.length)]), i * 3); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â const geometry = new Geometry(gl, { position: { size: 3, data: positions }, random: { size: 4, data: randoms }, color: { size: 3, data: colors } }); 
 Â  Â  Â  Â  Â  Â  Â  Â const particles = new Mesh(gl, { mode: gl.POINTS, geometry, program }); 
 Â  Â  Â  Â  Â  Â  Â  Â particles.setParent(scene); 
 Â  Â  Â  Â  Â  Â  Â  Â function resize() { renderer.setSize(window.innerWidth, window.innerHeight); camera.perspective({ aspect: window.innerWidth / window.innerHeight }); } 
 Â  Â  Â  Â  Â  Â  Â  Â window.addEventListener("resize", resize, false); 
 Â  Â  Â  Â  Â  Â  Â  Â resize(); 
 Â  Â  Â  Â  Â  Â  Â  Â requestAnimationFrame(update); 
 Â  Â  Â  Â  Â  Â  Â  Â function update(t) { requestAnimationFrame(update); program.uniforms.uTime.value = t * 0.001; renderer.render({ scene, camera }); } 
 Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â } 

 Â  Â  Â  Â const App = { 
 Â  Â  Â  Â  Â  Â state: {}, 
 Â  Â  Â  Â  Â  Â DOM: {}, 
 Â  Â  Â  Â  Â  Â db: null, 

 Â  Â  Â  Â  Â  Â CONFIG: { 
 Â  Â  Â  Â  Â  Â  Â  Â LEVELS: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 1: { name: "Ná»n táº£ng", tasks: ['MeaningMCQ', 'IPAFill', 'AudioListening'] }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 2: { name: "Ngá»¯ phÃ¡p & Cáº¥u trÃºc", tasks: ['WordFamilyMCQ', 'SentenceUnscramble', 'ErrorCorrection', 'TripledSentence'] }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 3: { name: "Ngá»¯ nghÄ©a & Ngá»¯ dá»¥ng", tasks: ['BestFitReplacement', 'BestParaphrase', 'AntonymMCQ'] }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 4: { name: "TÆ° duy Pháº£n biá»‡n", tasks: ['InferenceFromScenario', 'MainIdea', 'ParagraphCompletion', 'ArgumentStrengthening', 'ArgumentWeakening', 'TonePurposeAnalysis', 'SentenceRoleAnalysis'] } 
 Â  Â  Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â  Â  Â RULES: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â UNLOCK_THRESHOLD: 0.9, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â PROFICIENCY_TEST_UNLOCK: { 2: 0.8, 3: 0.9 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â PROFICIENCY_TESTS: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 1: { passMark: 0.9, maxAttempts: 3 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 2: { passMark: 0.9, maxAttempts: 3 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 3: { passMark: 0.9, maxAttempts: 3 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â FINAL_TEST_UNLOCK_THRESHOLD: 0.8, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â PRACTICE_SESSION_LENGTH: 10, 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â EXERCISE_INFO: { 
 Â  Â  Â  Â  Â  Â  Â  Â 'MeaningMCQ': { name: 'Meaning MCQ', icon: 'fas fa-lightbulb', desc: 'Chá»n Ä‘Ãºng nghÄ©a tiáº¿ng Viá»‡t cá»§a tá»« Ä‘Ã£ cho.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'WordFamilyMCQ': { name: 'Word Family', icon: 'fas fa-users', desc: 'Chá»n dáº¡ng tá»« Ä‘Ãºng (danh tá»«, Ä‘á»™ng tá»«, tÃ­nh tá»«...) Ä‘á»ƒ hoÃ n thÃ nh cÃ¢u.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'SentenceUnscramble': { name: 'Sentence Unscramble', icon: 'fas fa-random', desc: 'Sáº¯p xáº¿p cÃ¡c tá»« bá»‹ xÃ¡o trá»™n thÃ nh má»™t cÃ¢u hoÃ n chá»‰nh.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'ErrorCorrection': { name: 'Error Correction', icon: 'fas fa-pen-alt', desc: 'Äá»c vÃ  sá»­a láº¡i lá»—i sai trong cÃ¢u.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'IPAFill': { name: 'IPA Fill', icon: 'fas fa-comment-dots', desc: 'Chá»n Ä‘Ãºng nguyÃªn Ã¢m Ä‘á»ƒ hoÃ n thÃ nh phiÃªn Ã¢m IPA cá»§a tá»«.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'BestFitReplacement': { name: 'Best-fit Replacement', icon: 'fas fa-bullseye', desc: 'Chá»n tá»« Ä‘á»“ng nghÄ©a phÃ¹ há»£p nháº¥t Ä‘á»ƒ thay tháº¿ tá»« Ä‘Æ°á»£c gáº¡ch chÃ¢n.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'InferenceFromScenario': { name: 'Inference from Scenario', icon: 'fas fa-brain', desc: 'Äá»c má»™t tÃ¬nh huá»‘ng ngáº¯n vÃ  tráº£ lá»i cÃ¢u há»i suy luáº­n vá» nÃ³.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'BestParaphrase': { name: 'Best Paraphrase', icon: 'fas fa-file-alt', desc: 'Chá»n cÃ¢u diá»…n giáº£i láº¡i Ä‘Ãºng nháº¥t Ã½ cá»§a cÃ¢u gá»‘c.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'AudioListening': { name: 'Listening & Typing', icon: 'fas fa-headphones-alt', desc: 'Nghe vÃ  gÃµ láº¡i chÃ­nh xÃ¡c tá»« báº¡n nghe Ä‘Æ°á»£c.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'AntonymMCQ': { name: 'Antonym Challenge', icon: 'fas fa-exchange-alt', desc: 'Chá»n tá»« cÃ³ nghÄ©a trÃ¡i ngÆ°á»£c vá»›i tá»« cho trÆ°á»›c.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'TripledSentence': { name: 'Tripled Sentence', icon: 'fas fa-puzzle-piece', desc: 'Má»™t tá»« bá»‹ thiáº¿u trong cáº£ ba cÃ¢u. HÃ£y tÃ¬m ra tá»« Ä‘Ã³.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'MainIdea': { name: 'Find the Main Idea', icon: 'fas fa-sitemap', desc: 'Äá»c má»™t Ä‘oáº¡n vÄƒn ngáº¯n vÃ  chá»n cÃ¢u diá»…n Ä‘áº¡t Ä‘Ãºng nháº¥t Ã½ chÃ­nh.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'ParagraphCompletion': { name: 'Find the Conclusion', icon: 'fas fa-flag-checkered', desc: 'Chá»n cÃ¢u phÃ¹ há»£p nháº¥t Ä‘á»ƒ káº¿t thÃºc Ä‘oáº¡n vÄƒn.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'ArgumentStrengthening': { name: 'Strengthen the Argument', icon: 'fas fa-thumbs-up', desc: 'Chá»n luáº­n Ä‘iá»ƒm cá»§ng cá»‘ máº¡nh nháº¥t cho láº­p luáº­n cá»§a tÃ¡c giáº£.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'ArgumentWeakening': { name: 'Weaken the Argument', icon: 'fas fa-thumbs-down', desc: 'Chá»n luáº­n Ä‘iá»ƒm lÃ m suy yáº¿u nháº¥t láº­p luáº­n cá»§a tÃ¡c giáº£.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'TonePurposeAnalysis': { name: 'Tone/Purpose Identification', icon: 'fas fa-theater-masks', desc: 'XÃ¡c Ä‘á»‹nh giá»ng vÄƒn (thÃ¡i Ä‘á»™) hoáº·c má»¥c Ä‘Ã­ch viáº¿t cá»§a tÃ¡c giáº£.' }, 
 Â  Â  Â  Â  Â  Â  Â  Â 'SentenceRoleAnalysis': { name: 'Sentence Role Analysis', icon: 'fas fa-search-plus', desc: 'PhÃ¢n tÃ­ch vÃ  xÃ¡c Ä‘á»‹nh vai trÃ² cá»§a má»™t cÃ¢u Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u trong láº­p luáº­n.' }, 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async init() { 
 Â  Â  Â  Â  Â  Â  Â  Â const firebaseConfig = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â apiKey: "AIzaSyBUet6ZsBTwJG_gTKM2bGFG1AKD3t0hV20", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â authDomain: "b1-baotram.firebaseapp.com", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â projectId: "b1-baotram", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â storageBucket: "b1-baotram.appspot.com", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â messagingSenderId: "948701163187", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â appId: "1:948701163187:web:043f2d381d63e741114ac6", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â measurementId: "G-33NHT07JHE" 
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const firebaseApp = initializeApp(firebaseConfig); 
 Â  Â  Â  Â  Â  Â  Â  Â this.db = getFirestore(firebaseApp); 

 Â  Â  Â  Â  Â  Â  Â  Â this.DOM = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â loader: document.getElementById('loader-overlay'), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â loaderText: document.getElementById('loader-text'), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container: document.getElementById('app-container'), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â header: document.getElementById('app-header'), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â main: document.getElementById('app-main'), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â modal: document.getElementById('modal-container'), 
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â this.resetState(); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const params = new URLSearchParams(window.location.search); 
 Â  Â  Â  Â  Â  Â  Â  Â const submissionId = params.get('submission_id'); 

 Â  Â  Â  Â  Â  Â  Â  Â if (!submissionId) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("Lá»—i", "KhÃ´ng tÃ¬m tháº¥y mÃ£ bÃ i lÃ m (Submission ID)."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.DOM.loader.classList.add('hidden'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.submissionId = submissionId; 
 Â  Â  Â  Â  Â  Â  Â  Â await this.loadData(submissionId); 

 Â  Â  Â  Â  Â  Â  Â  Â window.addEventListener('beforeunload', (e) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (this.state.submissionId) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // This is a failsafe, but async operations are not guaranteed here. 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Main saving logic is now tied to explicit navigation. 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â resetState() { 
 Â  Â  Â  Â  Â  Â  Â  Â this.state = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â submissionId: null, studentId: '', studentName: '', testData: {}, wordList: [], 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isSubmitting: false, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â userProgress: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â levels: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 1: { status: 'locked', completedTasks: new Set(), totalTasks: 0, testAttempts: 0 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 2: { status: 'locked', completedTasks: new Set(), totalTasks: 0, testAttempts: 0 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 3: { status: 'locked', completedTasks: new Set(), totalTasks: 0, testAttempts: 0 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 4: { status: 'locked', completedTasks: new Set(), totalTasks: 0, testAttempts: 0 }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â totalCompletedTasks: 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â totalTasksInTest: 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â finalTestTaken: false, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â finalTestScore: null, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â currentPractice: { level: null, items: [], index: 0, isTest: false, correctAnswer: null, score: 0, sessionCorrectUIDs: new Set(), sessionIncorrectUIDs: new Set() }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â currentFlashcard: { items: [], index: 0 } 
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â // --- DATA LOADING (REWRITTEN FOR NEW STRUCTURE) --- 
 Â  Â  Â  Â  Â  Â async loadData(submissionId) { 
 Â  Â  Â  Â  Â  Â  Â  Â try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 1. Fetch the submission document first 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const submissionRef = doc(this.db, 'submissions', submissionId); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const submissionSnap = await getDoc(submissionRef); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!submissionSnap.exists()) throw new Error("MÃ£ bÃ i lÃ m khÃ´ng há»£p lá»‡."); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const submissionData = submissionSnap.data(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const testId = submissionData.testId; // Assumes submission doc has a 'testId' field 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!testId) throw new Error("BÃ i lÃ m khÃ´ng liÃªn káº¿t vá»›i bá»™ tá»« vá»±ng nÃ o (thiáº¿u testId)."); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.studentId = submissionData.studentId; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.testData = submissionData.testSnapshot || {}; // Keep snapshot for metadata like title 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // --- DUAL-READ LOGIC FOR WORD LIST --- 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 2. Try fetching from the new sub-collection structure 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const wordsColRef = collection(this.db, "vocab_sets", testId, "words"); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const wordsSnapshot = await getDocs(wordsColRef); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!wordsSnapshot.empty) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.log(`Loaded ${wordsSnapshot.size} words from new structure (sub-collection).`); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.wordList = wordsSnapshot.docs.map(doc => doc.data()); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (this.state.testData.wordList && Array.isArray(this.state.testData.wordList)) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 3. Fallback to the old array structure if sub-collection is empty 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.warn(`'words' sub-collection is empty. Falling back to old 'wordList' array from snapshot.`); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.wordList = this.state.testData.wordList; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw new Error("KhÃ´ng tÃ¬m tháº¥y dá»¯ liá»‡u tá»« vá»±ng cho bÃ i lÃ m nÃ y."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Sort words by ID to ensure consistent order 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.wordList.sort((a, b) => (a.id || 0) - (b.id || 0)); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 4. Fetch student name 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const userDoc = await getDoc(doc(this.db, "users", this.state.studentId)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.studentName = userDoc.exists() ? userDoc.data().displayName : "KhÃ´ng rÃµ"; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 5. Calculate total tasks and initialize progress (this logic remains the same) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let totalTasks = 0; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Object.keys(this.CONFIG.LEVELS).forEach(level => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const tasksForLevel = this.CONFIG.LEVELS[level].tasks; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let count = 0; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.wordList.forEach(word => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (word.generated_tasks) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tasksForLevel.forEach(taskType => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (this.isTaskAvailable(word, taskType)) count++; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.levels[level].totalTasks = count; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â totalTasks += count; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.totalTasksInTest = totalTasks; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 6. Load saved progress 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (submissionData.adaptiveProgressV2) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const progress = submissionData.adaptiveProgressV2; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!progress.levels) progress.levels = this.state.userProgress.levels; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Object.keys(this.CONFIG.LEVELS).forEach(level => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!progress.levels[level]) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â progress.levels[level] = this.state.userProgress.levels[level]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â progress.levels[level].completedTasks = new Set(progress.levels[level].completedTasks || []); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â progress.levels[level].totalTasks = this.state.userProgress.levels[level].totalTasks; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress = { ...this.state.userProgress, ...progress }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.levels[1].status = 'unlocked'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.totalCompletedTasks = this.calculateTotalCompletedTasks(); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 7. Render the app 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.DOM.loader.classList.add('hidden'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.DOM.container.classList.remove('hidden'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderDashboard(); 

 Â  Â  Â  Â  Â  Â  Â  Â } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.error("Load data error:", error); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.DOM.loader.classList.add('hidden'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("Lá»—i", "KhÃ´ng thá»ƒ táº£i phiÃªn lÃ m bÃ i: " + error.message); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â isTaskAvailable(word, taskType) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = word.generated_tasks; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return false; 
 Â  Â  Â  Â  Â  Â  Â  Â switch (taskType) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'MeaningMCQ': return tasks.meaning_mcq?.distractors_vi?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'WordFamilyMCQ': return tasks.word_family_mcq?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'SentenceUnscramble': return !!tasks.sentence_unscramble?.correct_sentence; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ErrorCorrection': return !!tasks.error_correction?.incorrect_sentence; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'IPAFill': return tasks.ipa_fill?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'BestFitReplacement': return tasks.best_fit_replacement?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'InferenceFromScenario': return tasks.inference_from_scenario?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'BestParaphrase': return tasks.best_paraphrase?.options?.length > 1; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'AudioListening': return !!word.audioUrl; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'AntonymMCQ': return tasks.antonym_mcq?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'TripledSentence': return tasks.tripled_sentence?.examples?.length >= 1; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'MainIdea': return tasks.main_idea?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ParagraphCompletion': return tasks.paragraph_completion?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ArgumentStrengthening': return tasks.argument_strengthening?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ArgumentWeakening': return tasks.argument_weakening?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'TonePurposeAnalysis': return tasks.tone_purpose_analysis?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'SentenceRoleAnalysis': return tasks.sentence_role_analysis?.distractors?.length >= 3; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â default: return false; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async updateFirestoreProgress() { 
 Â  Â  Â  Â  Â  Â  Â  Â if (!this.state.submissionId) return; 
 Â  Â  Â  Â  Â  Â  Â  Â const progressToSave = JSON.parse(JSON.stringify(this.state.userProgress)); 
 Â  Â  Â  Â  Â  Â  Â  Â Object.keys(progressToSave.levels).forEach(level => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (progressToSave.levels[level]?.completedTasks) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â progressToSave.levels[level].completedTasks = Array.from(this.state.userProgress.levels[level].completedTasks); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const submissionRef = doc(this.db, 'submissions', this.state.submissionId); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await updateDoc(submissionRef, { adaptiveProgressV2: progressToSave }); 
 Â  Â  Â  Â  Â  Â  Â  Â } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.error("Lá»—i khi Ä‘á»“ng bá»™ tiáº¿n trÃ¬nh:", error); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â calculateTotalCompletedTasks() { 
 Â  Â  Â  Â  Â  Â  Â  Â let count = 0; 
 Â  Â  Â  Â  Â  Â  Â  Â Object.values(this.state.userProgress.levels).forEach(levelData => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (levelData.status === 'passed') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â count += levelData.totalTasks; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (levelData.completedTasks) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â count += levelData.completedTasks.size; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â return count; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â renderHeader() { 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.totalCompletedTasks = this.calculateTotalCompletedTasks(); 
 Â  Â  Â  Â  Â  Â  Â  Â const { totalCompletedTasks, totalTasksInTest } = this.state.userProgress; 
 Â  Â  Â  Â  Â  Â  Â  Â const overallProgress = totalTasksInTest > 0 ? (totalCompletedTasks / totalTasksInTest * 100) : 0; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.header.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-4 flex flex-wrap justify-between items-center gap-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h1 class="text-2xl font-bold">${this.state.testData.title || 'Lá»™ trÃ¬nh há»c táº­p'}</h1> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-text-secondary">Há»c sinh: <span class="font-medium text-text-light">${this.state.studentName}</span></p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center gap-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <a href="student-dashboard.html" id="header-back-btn" class="cta-btn secondary !py-2 !px-4"><i class="fas fa-arrow-left mr-2"></i> Dashboard há»c sinh</a>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="w-full sm:w-auto flex-grow sm:flex-grow-0 max-w-xs"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-center font-medium mb-1">Tiáº¿n Ä‘á»™ tá»•ng quÃ¡t: ${overallProgress.toFixed(1)}%</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-track"><div class="progress-fill" style="width: ${overallProgress.toFixed(1)}%;"></div></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('header-back-btn')?.addEventListener('click', async (e) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.preventDefault(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const btn = e.currentTarget; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Äang lÆ°u...'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â btn.disabled = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â window.location.href = btn.href; 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â renderDashboard() { 
 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.main.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 fade-in"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <aside class="lg:col-span-1 space-y-6"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-6"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-xl font-bold mb-4">ğŸ“š Báº¯t Ä‘áº§u</h2> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="space-y-3"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="show-guide-btn" class="cta-btn secondary w-full !rounded-lg"><i class="fas fa-book-open mr-2"></i>Xem HÆ°á»›ng Dáº«n & Quy Táº¯c</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-flashcard-type="word" class="cta-btn secondary w-full !rounded-lg"><i class="fas fa-clone mr-2"></i>Flashcard Tá»« Vá»±ng</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-flashcard-type="structure" class="cta-btn secondary w-full !rounded-lg" disabled><i class="fas fa-sitemap mr-2"></i>Flashcard Cáº¥u TrÃºc</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </aside> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <main class="lg:col-span-2 space-y-6"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-6 sm:p-8"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-2xl font-bold mb-6">ğŸ‹ï¸â€â™€ï¸ Lá»™ TrÃ¬nh Luyá»‡n Táº­p</h2> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="levels-container" class="grid grid-cols-1 sm:grid-cols-2 gap-6"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="final-test-container" class="glass-panel p-8 text-center"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </main> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderLevelCards(); 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderFinalTestSection(); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('show-guide-btn').addEventListener('click', () => this.renderGuideModal()); 
 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.main.querySelectorAll('button[data-flashcard-type]').forEach(btn => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â btn.addEventListener('click', (e) => this.startFlashcardSession(e.currentTarget.dataset.flashcardType)); 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â renderLevelCards() { 
 Â  Â  Â  Â  Â  Â  Â  Â const container = document.getElementById('levels-container'); 
 Â  Â  Â  Â  Â  Â  Â  Â if (!container) return; 
 Â  Â  Â  Â  Â  Â  Â  Â container.innerHTML = Object.keys(this.CONFIG.LEVELS).map(levelKey => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const levelNum = parseInt(levelKey); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const levelConfig = this.CONFIG.LEVELS[levelNum]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const progress = this.state.userProgress.levels[levelNum]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let statusClass = progress.status; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let buttonText = 'Luyá»‡n táº­p'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let buttonDisabled = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let icon = 'fa-lock'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let testButtonHTML = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const percent = progress.totalTasks > 0 ? (progress.completedTasks.size / progress.totalTasks) : 0; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (progress.status === 'passed') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â buttonText = 'ÄÃ£ qua'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â icon = 'fa-check-circle text-correct-color'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â buttonDisabled = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (progress.status === 'unlocked') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â statusClass = 'unlocked'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â buttonDisabled = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â icon = 'fa-play-circle'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const testConfig = this.CONFIG.RULES.PROFICIENCY_TESTS[levelNum]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const testUnlockThreshold = this.CONFIG.RULES.PROFICIENCY_TEST_UNLOCK[levelNum]; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let canTakeTest = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (levelNum === 1) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â canTakeTest = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (testUnlockThreshold && percent >= testUnlockThreshold) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â canTakeTest = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (testConfig && canTakeTest && progress.testAttempts < testConfig.maxAttempts) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â testButtonHTML = `<button data-test-level="${levelNum}" class="cta-btn w-full !rounded-lg mt-3 !text-sm !py-2">Kiá»ƒm tra vÆ°á»£t cáº¥p (${progress.testAttempts}/${testConfig.maxAttempts})</button>`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="level-card-${levelNum}" class="level-card p-6 rounded-2xl ${statusClass}"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-between items-start mb-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="font-bold text-2xl">Level ${levelNum}</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas ${icon} text-2xl"></i> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-text-secondary mb-4 text-left">${levelConfig.name}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-track mb-4"><div class="progress-fill" style="width: ${(percent * 100).toFixed(0)}%;"></div></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-level="${levelNum}" class="cta-btn secondary w-full !rounded-lg" ${buttonDisabled}>${buttonText}</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${testButtonHTML} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â  Â  Â }).join(''); 

 Â  Â  Â  Â  Â  Â  Â  Â container.addEventListener('click', e => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const practiceButton = e.target.closest('button[data-level]'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const testButton = e.target.closest('button[data-test-level]'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (practiceButton && !practiceButton.disabled) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.startPractice(parseInt(practiceButton.dataset.level)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (testButton && !testButton.disabled) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.runProficiencyTest(parseInt(testButton.dataset.testLevel)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â renderFinalTestSection() { 
 Â  Â  Â  Â  Â  Â  Â  Â const container = document.getElementById('final-test-container'); 
 Â  Â  Â  Â  Â  Â  Â  Â if (!container) return; 
 Â  Â  Â  Â  Â  Â  Â  Â const totalCompleted = this.calculateTotalCompletedTasks(); 
 Â  Â  Â  Â  Â  Â  Â  Â const { totalTasksInTest, finalTestTaken, finalTestScore } = this.state.userProgress; 
 Â  Â  Â  Â  Â  Â  Â  Â const overallProgress = totalTasksInTest > 0 ? (totalCompleted / totalTasksInTest) : 0; 
 Â  Â  Â  Â  Â  Â  Â  Â const isEligible = overallProgress >= this.CONFIG.RULES.FINAL_TEST_UNLOCK_THRESHOLD; 

 Â  Â  Â  Â  Â  Â  Â  Â if (isEligible) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-xl font-bold mb-4">BÃ i Kiá»ƒm Tra Cuá»‘i Ká»³</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-text-secondary mb-6">Báº¡n Ä‘Ã£ Ä‘á»§ Ä‘iá»u kiá»‡n. HÃ£y báº¯t Ä‘áº§u bÃ i kiá»ƒm tra cuá»‘i cÃ¹ng Ä‘á»ƒ hoÃ n táº¥t!</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="start-final-test-btn" class="cta-btn danger w-full max-w-xs mx-auto" ${finalTestTaken ? 'disabled' : ''}> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-graduation-cap mr-2"></i> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${finalTestTaken ? `ÄÃ£ lÃ m (Äiá»ƒm: ${finalTestScore}%)` : 'Báº¯t Ä‘áº§u KT Cuá»‘i Ká»³'} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.querySelector('#start-final-test-btn')?.addEventListener('click', () => this.startFinalTest()); 
 Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.innerHTML = `<p class="text-text-secondary"><i class="fas fa-lock mr-2"></i>HoÃ n thÃ nh ${(this.CONFIG.RULES.FINAL_TEST_UNLOCK_THRESHOLD * 100)}% tiáº¿n Ä‘á»™ tá»•ng quÃ¡t Ä‘á»ƒ má»Ÿ khÃ³a.</p>`; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â async checkLevelUp(level) { 
 Â  Â  Â  Â  Â  Â  Â  Â const progress = this.state.userProgress.levels[level]; 
 Â  Â  Â  Â  Â  Â  Â  Â const nextLevelKey = level + 1; 
 Â  Â  Â  Â  Â  Â  Â  Â const nextLevelProgress = this.state.userProgress.levels[nextLevelKey]; 

 Â  Â  Â  Â  Â  Â  Â  Â if (!nextLevelProgress || nextLevelProgress.status !== 'locked') return; 

 Â  Â  Â  Â  Â  Â  Â  Â const percent = progress.totalTasks > 0 ? (progress.completedTasks.size / progress.totalTasks) : 0; 

 Â  Â  Â  Â  Â  Â  Â  Â if (percent >= this.CONFIG.RULES.UNLOCK_THRESHOLD) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â nextLevelProgress.status = 'unlocked'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal(`ğŸ‰ Má»Ÿ khÃ³a Level ${nextLevelKey}!`, `ChÃºc má»«ng! Báº¡n Ä‘Ã£ hoÃ n thÃ nh Ä‘á»§ bÃ i táº­p Ä‘á»ƒ má»Ÿ khÃ³a level tiáº¿p theo.`, false, () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderLevelCards(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }, null, 'Tuyá»‡t vá»i!'); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â startPractice(level) { 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â const levelProgress = this.state.userProgress.levels[level]; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const allLevelTasks = this.getAllTasksForLevel(level); 
 Â  Â  Â  Â  Â  Â  Â  Â // Prioritize uncompleted tasks 
 Â  Â  Â  Â  Â  Â  Â  Â const uncompletedTasks = this.shuffleArray(allLevelTasks.filter(task => !levelProgress.completedTasks.has(task.taskUID))); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â let practicePool = []; 

 Â  Â  Â  Â  Â  Â  Â  Â if (uncompletedTasks.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â practicePool.push(...uncompletedTasks); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â // If not enough uncompleted tasks, fill with completed ones for review 
 Â  Â  Â  Â  Â  Â  Â  Â if (practicePool.length < this.CONFIG.RULES.PRACTICE_SESSION_LENGTH) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const completedTasks = this.shuffleArray(allLevelTasks.filter(task => levelProgress.completedTasks.has(task.taskUID))); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const needed = this.CONFIG.RULES.PRACTICE_SESSION_LENGTH - practicePool.length; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â practicePool.push(...completedTasks.slice(0, needed)); 
 Â  Â  Â  Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â if (practicePool.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("HoÃ n thÃ nh!", "Báº¡n Ä‘Ã£ lÃ m háº¿t cÃ¡c bÃ i táº­p cho level nÃ y. HÃ£y thá»­ lÃ m bÃ i kiá»ƒm tra vÆ°á»£t cáº¥p náº¿u cÃ³, hoáº·c quay láº¡i sau.", false, () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderDashboard(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â level: level, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â items: practicePool.slice(0, this.CONFIG.RULES.PRACTICE_SESSION_LENGTH), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â index: 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isTest: false, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â score: 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â correctAnswer: null, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sessionCorrectUIDs: new Set(), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sessionIncorrectUIDs: new Set() 
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderPracticeView(); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async runProficiencyTest(levelToTest) { 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â const progress = this.state.userProgress.levels[levelToTest]; 
 Â  Â  Â  Â  Â  Â  Â  Â const testConfig = this.CONFIG.RULES.PROFICIENCY_TESTS[levelToTest]; 
 Â  Â  Â  Â  Â  Â  Â  Â if (progress.testAttempts >= testConfig.maxAttempts) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("ThÃ´ng bÃ¡o", "Báº¡n Ä‘Ã£ háº¿t sá»‘ láº§n lÃ m bÃ i kiá»ƒm tra cho level nÃ y."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const allLevelTasks = this.getAllTasksForLevel(levelToTest); 

 Â  Â  Â  Â  Â  Â  Â  Â if (allLevelTasks.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("Lá»—i", "KhÃ´ng cÃ³ cÃ¢u há»i nÃ o cho bÃ i kiá»ƒm tra nÃ y."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
                
                // [THAY Äá»”I] Logic tÃ­nh sá»‘ cÃ¢u há»i cho bÃ i kiá»ƒm tra
 Â  Â  Â  Â  Â  Â  Â  Â let desiredQuestions = Math.max(20, Math.ceil(allLevelTasks.length * 0.25)); // Ãp dá»¥ng cháº·n dÆ°á»›i (min 20)
                desiredQuestions = Math.min(50, desiredQuestions); // Ãp dá»¥ng cháº·n trÃªn (max 50)
                const numQuestions = Math.min(allLevelTasks.length, desiredQuestions); // Sá»‘ cÃ¢u há»i cuá»‘i cÃ¹ng khÃ´ng Ä‘Æ°á»£c vÆ°á»£t quÃ¡ sá»‘ cÃ¢u cÃ³ sáºµn

 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice = { 
                    items: this.shuffleArray(allLevelTasks).slice(0, numQuestions), 
                    level: levelToTest, 
                    index: 0, 
                    isTest: true, 
                    score: 0, 
                    correctAnswer: null,
                    // [THAY Äá»”I] Bá»• sung cÃ¡c thuá»™c tÃ­nh cÃ²n thiáº¿u Ä‘á»ƒ Ä‘áº£m báº£o cáº¥u trÃºc nháº¥t quÃ¡n
                    sessionCorrectUIDs: new Set(),
                    sessionIncorrectUIDs: new Set()
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â progress.testAttempts++; 
 Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderPracticeView(); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â startFinalTest() { 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â let allTasks = []; 
 Â  Â  Â  Â  Â  Â  Â  Â Object.keys(this.CONFIG.LEVELS).forEach(level => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â allTasks.push(...this.getAllTasksForLevel(level)); 
 Â  Â  Â  Â  Â  Â  Â  Â }); 

 Â  Â  Â  Â  Â  Â  Â  Â if (allTasks.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("Lá»—i", "KhÃ´ng cÃ³ cÃ¢u há»i nÃ o cho bÃ i kiá»ƒm tra cuá»‘i ká»³."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â level: "Final", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â items: this.shuffleArray(allTasks).slice(0, 50), // Limit final test to 50 questions 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â index: 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isTest: true, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â score: 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â correctAnswer: null 
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderPracticeView(); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â renderPracticeView() { 
 Â  Â  Â  Â  Â  Â  Â  Â const { items, index, level, isTest } = this.state.currentPractice; 
 Â  Â  Â  Â  Â  Â  Â  Â const total = items.length; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â if (index >= total) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (isTest) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â level === "Final" ? this.renderFinalTestSummary() : this.renderTestSummary(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderSessionSummary(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const currentItem = items[index]; 
 Â  Â  Â  Â  Â  Â  Â  Â const renderFunction = this[`get${currentItem.exerciseType}HTML`]; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const title = isTest ? `Kiá»ƒm tra ${level === "Final" ? "Cuá»‘i ká»³" : `Level ${level}`}` : `Level ${level} - Luyá»‡n táº­p`; 

 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.main.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-6 sm:p-8 fade-in"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-between items-center mb-6"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="font-bold text-primary-accent">${title}</h2> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center gap-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm font-medium text-text-secondary">CÃ¢u ${index + 1} / ${total}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="exit-practice-btn" class="text-sm font-semibold text-text-secondary hover:text-incorrect-color transition-colors"><i class="fas fa-times mr-1"></i> ThoÃ¡t</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="question-container" class="min-h-[300px]"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${renderFunction ? renderFunction.call(this, currentItem) : 'Lá»—i: KhÃ´ng thá»ƒ render cÃ¢u há»i.'} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="feedback-container" class="mt-6 min-h-[68px]"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="report-actions"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="report-btn" data-report-type="error"><i class="fas fa-bug mr-2"></i>BÃ¡o lá»—i</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="report-btn" data-report-type="explanation"><i class="fas fa-question-circle mr-2"></i>Cáº§n giáº£i thÃ­ch</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â `; 

 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('exit-practice-btn').addEventListener('click', async () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderDashboard(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â }); 

 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.main.querySelector('.report-actions').addEventListener('click', e => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const button = e.target.closest('button'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (button && button.dataset.reportType) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.handleReportSubmission(button.dataset.reportType); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â this.attachPracticeEventListeners(currentItem, document.getElementById('question-container')); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async renderTestSummary() { 
 Â  Â  Â  Â  Â  Â  Â  Â const { level, score, items } = this.state.currentPractice; 
 Â  Â  Â  Â  Â  Â  Â  Â const total = items.length; 
 Â  Â  Â  Â  Â  Â  Â  Â const accuracy = total > 0 ? (score / total) : 0; 
 Â  Â  Â  Â  Â  Â  Â  Â const testConfig = this.CONFIG.RULES.PROFICIENCY_TESTS[level]; 
 Â  Â  Â  Â  Â  Â  Â  Â const didPass = accuracy >= testConfig.passMark; 
 Â  Â  Â  Â  Â  Â  Â  Â let title = didPass ? "ğŸ‰ ChÃºc má»«ng, báº¡n Ä‘Ã£ qua!" : "Cáº§n cá»‘ gáº¯ng hÆ¡n!"; 
 Â  Â  Â  Â  Â  Â  Â  Â let message = `Báº¡n Ä‘Ã£ tráº£ lá»i Ä‘Ãºng ${score} / ${total} cÃ¢u, Ä‘áº¡t <strong>${(accuracy * 100).toFixed(1)}%</strong>. Tá»‰ lá»‡ yÃªu cáº§u lÃ  ${(testConfig.passMark * 100)}%.`; 
 Â  Â  Â  Â  Â  Â  Â  Â const levelProgress = this.state.userProgress.levels[level]; 

 Â  Â  Â  Â  Â  Â  Â  Â if (didPass) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â message += `<br>Level ${level} Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  hoÃ n thÃ nh. ToÃ n bá»™ kiáº¿n thá»©c cá»§a level nÃ y Ä‘Æ°á»£c tÃ­nh lÃ  Ä‘Ã£ há»c.`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â levelProgress.status = 'passed'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const tasksForLevel = this.getAllTasksForLevel(level); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tasksForLevel.forEach(task => levelProgress.completedTasks.add(task.taskUID)); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const nextLevel = level + 1; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (this.CONFIG.LEVELS[nextLevel]) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.levels[nextLevel].status = 'unlocked'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const attemptsLeft = testConfig.maxAttempts - levelProgress.testAttempts; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â message += `<br>Báº¡n cÃ²n <strong>${attemptsLeft}</strong> láº§n thá»­ láº¡i. HÃ£y luyá»‡n táº­p thÃªm nhÃ©.`; 
 Â  Â  Â  Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â this.showModal(title, message, false, () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderDashboard(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â }, null, "Vá» Báº£ng Ä‘iá»u khiá»ƒn"); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async renderFinalTestSummary() { 
 Â  Â  Â  Â  Â  Â  Â  Â const { score, items } = this.state.currentPractice; 
 Â  Â  Â  Â  Â  Â  Â  Â const total = items.length; 
 Â  Â  Â  Â  Â  Â  Â  Â const accuracy = total > 0 ? (score / total * 100) : 0; 

 Â  Â  Â  Â  Â  Â  Â  Â let title = "HoÃ n thÃ nh bÃ i kiá»ƒm tra cuá»‘i ká»³!"; 
 Â  Â  Â  Â  Â  Â  Â  Â let message = `ChÃºc má»«ng báº¡n Ä‘Ã£ hoÃ n thÃ nh bÃ i kiá»ƒm tra cuá»‘i cÃ¹ng! <br>Káº¿t quáº£ cá»§a báº¡n lÃ : <strong>${score} / ${total} cÃ¢u Ä‘Ãºng (${accuracy.toFixed(1)}%)</strong>.`; 

 Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.finalTestTaken = true; 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.userProgress.finalTestScore = accuracy.toFixed(1); 

 Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â this.showModal(title, message, false, () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderDashboard(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â }, null, "Vá» Báº£ng Ä‘iá»u khiá»ƒn"); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async renderSessionSummary() { 
 Â  Â  Â  Â  Â  Â  Â  Â const { level, sessionCorrectUIDs, sessionIncorrectUIDs } = this.state.currentPractice; 
 Â  Â  Â  Â  Â  Â  Â  Â const correctCount = sessionCorrectUIDs.size; 
 Â  Â  Â  Â  Â  Â  Â  Â const incorrectCount = sessionIncorrectUIDs.size; 

 Â  Â  Â  Â  Â  Â  Â  Â const message = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-left"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="mb-4">Báº¡n vá»«a hoÃ n thÃ nh má»™t phiÃªn luyá»‡n táº­p. DÆ°á»›i Ä‘Ã¢y lÃ  káº¿t quáº£:</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-bg-dark p-4 rounded-lg border border-glass-border"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="font-bold text-green-400 mb-2">ÄÃ£ tráº£ lá»i Ä‘Ãºng (${correctCount})</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-text-secondary">Tuyá»‡t vá»i! Nhá»¯ng kiáº¿n thá»©c nÃ y Ä‘Ã£ Ä‘Æ°á»£c ghi nháº­n vÃ o tiáº¿n trÃ¬nh cá»§a báº¡n.</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-bg-dark p-4 rounded-lg border border-glass-border"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="font-bold text-red-400 mb-2">Cáº§n xem láº¡i (${incorrectCount})</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-text-secondary">Äá»«ng lo, há»‡ thá»‘ng sáº½ Æ°u tiÃªn nhá»¯ng dáº¡ng bÃ i nÃ y trong cÃ¡c phiÃªn há»c tá»›i.</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â  Â  Â await this.updateFirestoreProgress(); 
 Â  Â  Â  Â  Â  Â  Â  Â this.showModal(`Tá»•ng káº¿t phiÃªn há»c Level ${level}`, message, true, () => this.startPractice(level), () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderDashboard(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â }, "Luyá»‡n táº­p tiáº¿p", "Vá» Dashboard"); 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â // --- HTML Generation for Questions --- 
 Â  Â  Â  Â  Â  Â getQuestionHTML(item, renderFunction) { 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO[item.exerciseType]; 
 Â  Â  Â  Â  Â  Â  Â  Â const questionContent = renderFunction.call(this, item); 
 Â  Â  Â  Â  Â  Â  Â  Â if (questionContent.startsWith('<div')) { // If function returns a full block 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return questionContent; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â return ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="question-block"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-xl font-bold text-text-light mb-4 flex items-center"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>${info.name}</span> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </h2> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${questionContent} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â getMeaningMCQHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.meaning_mcq; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.distractors_vi) return '<div>KhÃ´ng cÃ³ Ä‘á»§ dá»¯ liá»‡u cho dáº¡ng bÃ i táº­p nÃ y.</div>'; 
 Â  Â  Â  Â  Â  Â  Â  Â const correctAnswer = item.meaning; 
 Â  Â  Â  Â  Â  Â  Â  Â const distractors = this.shuffleArray([...tasks.distractors_vi]).slice(0, 3); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = correctAnswer; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([correctAnswer, ...distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.MeaningMCQ; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><div class="min-h-[60px] mb-8 font-bold text-4xl text-center">${item.word}</div><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getWordFamilyMCQHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.word_family_mcq; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.sentence) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_answer; 
 Â  Â  Â  Â  Â  Â  Â  Â const sentence = tasks.sentence.replace(tasks.blank_placeholder, '<span class="font-bold text-primary-accent">[...]</span>'); 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_answer, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.WordFamilyMCQ; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-xl font-serif italic text-text-secondary min-h-[60px] mb-8">"${sentence}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getSentenceUnscrambleHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.sentence_unscramble; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.correct_sentence) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_sentence; 
 Â  Â  Â  Â  Â  Â  Â  Â const words = this.shuffleArray(tasks.correct_sentence.split(' ')); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.SentenceUnscramble; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Click vÃ o cÃ¡c tá»« theo Ä‘Ãºng thá»© tá»± Ä‘á»ƒ táº¡o thÃ nh cÃ¢u hoÃ n chá»‰nh.</p><div id="unscramble-answer-area" class="min-h-[60px] p-4 border-2 border-dashed border-gray-600 rounded-lg mb-4 flex flex-wrap gap-2"></div><div id="unscramble-source-area" class="flex flex-wrap gap-2">${words.map(word => `<button class="px-4 py-2 bg-purple-600 hover:bg-purple-500 transition-colors rounded-lg">${word}</button>`).join('')}</div><div class="mt-6 text-right"><button id="check-btn" class="cta-btn">Kiá»ƒm tra</button></div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getErrorCorrectionHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.error_correction; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.incorrect_sentence) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_sentence; 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.ErrorCorrection; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Viáº¿t láº¡i cÃ¢u sau cho Ä‘Ãºng.</p><p class="text-xl font-serif italic text-text-secondary min-h-[60px] mb-8">"${tasks.incorrect_sentence}"</p><div class="flex gap-2"><input type="text" id="text-input" class="text-input-styled w-full text-lg" placeholder="Nháº­p cÃ¢u Ä‘Ãºng táº¡i Ä‘Ã¢y..."><button id="check-btn" class="cta-btn !py-3">Kiá»ƒm tra</button></div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getIPAFillHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.ipa_fill; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.gapped_ipa) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_vowel; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_vowel, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.IPAFill; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Chá»n Ã¢m Ä‘Ãºng Ä‘á»ƒ hoÃ n thÃ nh phiÃªn Ã¢m cho tá»« <strong class="text-primary-accent">"${item.word}"</strong></p><p class="text-3xl font-mono text-center min-h-[60px] mb-8">/${tasks.gapped_ipa}/</p><div id="answer-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">${options.map(opt => `<button class="answer-option font-mono text-center !text-2xl" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getBestFitReplacementHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.best_fit_replacement; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.sentence) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_answer; 
 Â  Â  Â  Â  Â  Â  Â  Â const sentence = tasks.sentence.replace(tasks.word_to_replace, `<span class="font-bold text-primary-accent"><u>${tasks.word_to_replace}</u></span>`); 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_answer, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.BestFitReplacement; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-xl font-serif italic text-text-secondary min-h-[60px] mb-8">"${sentence}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getInferenceFromScenarioHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.inference_from_scenario; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.scenario) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_answer; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_answer, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.InferenceFromScenario; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-md font-serif italic text-text-secondary mb-4">"${tasks.scenario}"</p><p class="text-lg font-semibold text-text-light mb-6">${tasks.question}</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getBestParaphraseHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.best_paraphrase; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks || !tasks.options) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â const correctOption = tasks.options.find(opt => opt.is_correct); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = correctOption.text; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray(tasks.options.map(opt => opt.text)); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.BestParaphrase; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">CÃ¢u gá»‘c:</p><p class="text-xl font-serif italic text-text-secondary min-h-[60px] mb-8">"${tasks.original_sentence}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getAudioListeningHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = item.word; 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.AudioListening; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><div class="text-center mb-6"><button id="play-audio-btn" data-audio-url="${item.audioUrl}" class="text-6xl text-primary-accent hover:text-violet-400 transition-colors"><i class="fas fa-play-circle"></i></button></div><div class="flex gap-2"><input type="text" id="text-input" class="text-input-styled w-full text-lg" placeholder="Nháº­p tá»« báº¡n nghe Ä‘Æ°á»£c..."><button id="check-btn" class="cta-btn !py-3">Kiá»ƒm tra</button></div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getTripledSentenceHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.tripled_sentence; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.keyword; 
 Â  Â  Â  Â  Â  Â  Â  Â // [THAY Äá»”I] Logic thay tháº¿ tá»« cÃ³ xá»­ lÃ½ háº­u tá»‘
                const regex = new RegExp(`\\b(${tasks.keyword})(s|es|ed|ing)?\\b`, 'gi');
                const sentencesHTML = tasks.examples.map(sentence => {
                    const replacedSentence = sentence.replace(regex, (match, baseWord, suffix) => {
                        return `[...]${suffix || ''}`;
                    });
                    return `<p class="text-lg font-serif italic text-text-secondary mb-2">"${replacedSentence}"</p>`;
                }).join('');
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.TripledSentence; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">CÃ¹ng má»™t tá»« cÃ²n thiáº¿u trong cáº£ ba cÃ¢u sau.</p><div class="space-y-3 mb-6">${sentencesHTML}</div><div class="flex gap-2"><input type="text" id="text-input" class="text-input-styled w-full text-lg" placeholder="Nháº­p tá»« cÃ²n thiáº¿u..."><button id="check-btn" class="cta-btn !py-3">Kiá»ƒm tra</button></div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getAntonymMCQHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.antonym_mcq; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_antonym; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_antonym, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const sentence = tasks.sentence_context.replace(tasks.keyword, `<strong class="text-primary-accent">${tasks.keyword}</strong>`); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.AntonymMCQ; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">ÄÃ¢u lÃ  tá»« trÃ¡i nghÄ©a vá»›i tá»« Ä‘Æ°á»£c in Ä‘áº­m?</p><p class="text-xl font-serif italic text-text-secondary min-h-[60px] mb-8">"${sentence}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getMainIdeaHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.main_idea; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_answer; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_answer, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.MainIdea; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Äá»c Ä‘oáº¡n vÄƒn vÃ  chá»n Ã½ chÃ­nh.</p><p class="text-md font-serif italic text-text-secondary mb-6 p-4 border border-glass-border rounded-lg bg-black/10">"${tasks.paragraph}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getParagraphCompletionHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.paragraph_completion; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_conclusion; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_conclusion, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.ParagraphCompletion; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">CÃ¢u nÃ o sau Ä‘Ã¢y káº¿t thÃºc Ä‘oáº¡n vÄƒn há»£p lÃ½ nháº¥t?</p><p class="text-md font-serif italic text-text-secondary mb-6 p-4 border border-glass-border rounded-lg bg-black/10">"${tasks.paragraph_body}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getArgumentStrengtheningHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.argument_strengthening; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_evidence; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_evidence, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.ArgumentStrengthening; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Luáº­n Ä‘iá»ƒm nÃ o cá»§ng cá»‘ cho láº­p luáº­n sau?</p><p class="text-md font-serif italic text-text-secondary mb-6 p-4 border border-glass-border rounded-lg bg-black/10">"${tasks.argument_text}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getArgumentWeakeningHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.argument_weakening; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_weakener; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_weakener, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.ArgumentWeakening; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Luáº­n Ä‘iá»ƒm nÃ o lÃ m suy yáº¿u láº­p luáº­n sau?</p><p class="text-md font-serif italic text-text-secondary mb-6 p-4 border border-glass-border rounded-lg bg-black/10">"${tasks.argument_text}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getTonePurposeAnalysisHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.tone_purpose_analysis; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_answer; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_answer, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.TonePurposeAnalysis; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">${tasks.question}</p><p class="text-md font-serif italic text-text-secondary mb-6 p-4 border border-glass-border rounded-lg bg-black/10">"${tasks.paragraph}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â getSentenceRoleAnalysisHTML(item) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasks = item.generated_tasks.sentence_role_analysis; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!tasks) return this.getMeaningMCQHTML(item); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.correctAnswer = tasks.correct_role; 
 Â  Â  Â  Â  Â  Â  Â  Â const options = this.shuffleArray([tasks.correct_role, ...tasks.distractors]); 
 Â  Â  Â  Â  Â  Â  Â  Â const paragraphHTML = tasks.paragraph.replace(`[${tasks.highlighted_sentence_index + 1}]`, `<strong class="text-primary-accent">[${tasks.highlighted_sentence_index + 1}]</strong>`); 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO.SentenceRoleAnalysis; 
 Â  Â  Â  Â  Â  Â  Â  Â return `<div class="question-block"><h2 class="text-xl font-bold text-text-light mb-4 flex items-center"><i class="${info.icon} mr-3 text-primary-accent w-6 text-center"></i><span>${info.name}</span></h2><p class="text-text-secondary mb-4">Vai trÃ² cá»§a cÃ¢u Ä‘Æ°á»£c in Ä‘áº­m lÃ  gÃ¬?</p><p class="text-md font-serif italic text-text-secondary mb-6 p-4 border border-glass-border rounded-lg bg-black/10">"${paragraphHTML}"</p><div id="answer-options" class="space-y-3">${options.map(opt => `<button class="answer-option" data-answer="${opt}">${opt}</button>`).join('')}</div></div>`; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â attachPracticeEventListeners(item, container, isGuide = false) { 
 Â  Â  Â  Â  Â  Â  Â  Â if (!container) return; 
 Â  Â  Â  Â  Â  Â  Â  Â const checkAnswerFunction = isGuide ? this.checkGuideAnswer.bind(this) : this.checkAnswer.bind(this); 
 Â  Â  Â  Â  Â  Â  Â  Â switch(item.exerciseType) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'MeaningMCQ': case 'WordFamilyMCQ': case 'IPAFill': case 'BestFitReplacement': case 'InferenceFromScenario': case 'BestParaphrase': case 'AntonymMCQ': case 'MainIdea': case 'ParagraphCompletion': case 'ArgumentStrengthening': case 'ArgumentWeakening': case 'TonePurposeAnalysis': case 'SentenceRoleAnalysis': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.querySelectorAll('.answer-option').forEach(option => { option.addEventListener('click', (e) => checkAnswerFunction(e.currentTarget.dataset.answer, item, container, e.currentTarget)); }); break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'AudioListening': case 'ErrorCorrection': case 'TripledSentence': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const input = container.querySelector('#text-input'); const checkBtn = container.querySelector('#check-btn'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.querySelector('#play-audio-btn')?.addEventListener('click', (e) => { this.playAudio(e.currentTarget.dataset.audioUrl); }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (input && checkBtn) { const doCheck = () => checkAnswerFunction(input.value, item, container, input); checkBtn.addEventListener('click', doCheck); input.addEventListener('keypress', (e) => { if (e.key === 'Enter') doCheck(); }); } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â case 'SentenceUnscramble': { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const answerArea = container.querySelector('#unscramble-answer-area'); const sourceArea = container.querySelector('#unscramble-source-area'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const moveToken = (e) => { if (e.target.tagName === 'BUTTON') { const isFromSource = e.currentTarget.id === 'unscramble-source-area'; (isFromSource ? answerArea : sourceArea).appendChild(e.target); } }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sourceArea.addEventListener('click', moveToken); answerArea.addEventListener('click', moveToken); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.querySelector('#check-btn')?.addEventListener('click', () => { const answer = Array.from(answerArea.querySelectorAll('button')).map(t => t.textContent).join(' '); checkAnswerFunction(answer, item, container, answerArea); }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â checkAnswer(userAnswer, item, container, selectedElement) { 
 Â  Â  Â  Â  Â  Â  Â  Â const correctAnswer = this.state.currentPractice.correctAnswer; 
 Â  Â  Â  Â  Â  Â  Â  Â const isCorrect = userAnswer.trim().toLowerCase() === correctAnswer.trim().toLowerCase(); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â container.querySelectorAll('button, input').forEach(el => el.disabled = true); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const levelProgress = this.state.currentPractice.level !== "Final" && this.state.userProgress.levels[this.state.currentPractice.level]; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â if (isCorrect) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.sessionCorrectUIDs.add(item.taskUID); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(this.state.currentPractice.isTest) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.score++; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (levelProgress && !levelProgress.completedTasks.has(item.taskUID)) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â levelProgress.completedTasks.add(item.taskUID); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.sessionIncorrectUIDs.add(item.taskUID); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â this.showFeedback(isCorrect, correctAnswer, container, selectedElement); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â if (isCorrect && !this.state.currentPractice.isTest) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.checkLevelUp(this.state.currentPractice.level); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â checkGuideAnswer(userAnswer, item, container, selectedElement) { 
 Â  Â  Â  Â  Â  Â  Â  Â const correctAnswer = this.state.currentPractice.correctAnswer; 
 Â  Â  Â  Â  Â  Â  Â  Â const isCorrect = userAnswer.trim().toLowerCase() === correctAnswer.trim().toLowerCase(); 
 Â  Â  Â  Â  Â  Â  Â  Â container.querySelectorAll('button, input').forEach(el => el.disabled = true); 
 Â  Â  Â  Â  Â  Â  Â  Â this.showFeedback(isCorrect, correctAnswer, container.parentElement.querySelector('#guide-feedback-container'), selectedElement, true); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â showFeedback(isCorrect, correctAnswer, questionContainer, selectedElement, isGuide = false) { 
 Â  Â  Â  Â  Â  Â  Â  Â const feedbackContainer = document.getElementById(isGuide ? 'guide-feedback-container' : 'feedback-container'); 
 Â  Â  Â  Â  Â  Â  Â  Â if (!feedbackContainer) return; 

 Â  Â  Â  Â  Â  Â  Â  Â // Highlight selected MCQ option 
 Â  Â  Â  Â  Â  Â  Â  Â if(selectedElement && selectedElement.classList.contains('answer-option')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â selectedElement.classList.add('selected', isCorrect ? 'correct' : 'incorrect'); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â // Highlight correct MCQ option if answer was wrong 
 Â  Â  Â  Â  Â  Â  Â  Â if (!isCorrect) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const options = questionContainer.querySelectorAll('.answer-option'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â options.forEach(opt => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (opt.dataset.answer.trim().toLowerCase() === correctAnswer.trim().toLowerCase()) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â opt.classList.add('correct-answer'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â const bgColor = isCorrect ? 'bg-green-500/20' : 'bg-red-500/20'; 
 Â  Â  Â  Â  Â  Â  Â  Â const textColor = isCorrect ? 'text-green-300' : 'text-red-300'; 
 Â  Â  Â  Â  Â  Â  Â  Â let message = isCorrect ? 'ChÃ­nh xÃ¡c!' : `Sai rá»“i! ÄÃ¡p Ã¡n Ä‘Ãºng lÃ : <strong class="font-bold text-white">${correctAnswer}</strong>`; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const nextButtonHTML = isGuide ? '' : `<button id="next-question-btn" class="cta-btn secondary !py-2 !px-4">Tiáº¿p tá»¥c <i class="fas fa-arrow-right ml-2"></i></button>`; 

 Â  Â  Â  Â  Â  Â  Â  Â feedbackContainer.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="${bgColor} ${textColor} p-4 rounded-lg flex justify-between items-center fade-in"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="font-semibold">${message}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${nextButtonHTML} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â if (!isGuide) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const nextBtn = document.getElementById('next-question-btn'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â nextBtn.focus(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â nextBtn.addEventListener('click', () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.state.currentPractice.index++; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.renderPracticeView(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â shuffleArray(array) { 
 Â  Â  Â  Â  Â  Â  Â  Â for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } 
 Â  Â  Â  Â  Â  Â  Â  Â return array; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â showModal(title, message, showCancel = false, onConfirm = null, onCancel = null, confirmText = 'XÃ¡c nháº­n', cancelText = 'Há»§y', modalClass = 'max-w-md') { 
 Â  Â  Â  Â  Â  Â  Â  Â const modalId = 'main-modal'; 
 Â  Â  Â  Â  Â  Â  Â  Â const existingModal = document.getElementById(modalId); 
 Â  Â  Â  Â  Â  Â  Â  Â if (existingModal) existingModal.remove(); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const modalContainer = document.createElement('div'); 
 Â  Â  Â  Â  Â  Â  Â  Â modalContainer.id = modalId; 
 Â  Â  Â  Â  Â  Â  Â  Â modalContainer.className = "fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const buttonsHTML = showCancel 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ? `<button id="modal-cancel-btn" class="cta-btn secondary">${cancelText}</button><button id="modal-confirm-btn" class="cta-btn">${confirmText}</button>` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : `<button id="modal-confirm-btn" class="cta-btn w-full">${confirmText}</button>`; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â modalContainer.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-6 sm:p-8 w-full ${modalClass} fade-in max-h-[90vh] overflow-y-auto"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-xl font-bold mb-4 text-left">${title}</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-text-secondary mb-6">${message}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex gap-4 justify-end mt-8">${buttonsHTML}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.modal.appendChild(modalContainer); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const confirmBtn = modalContainer.querySelector('#modal-confirm-btn'); 
 Â  Â  Â  Â  Â  Â  Â  Â const cancelBtn = modalContainer.querySelector('#modal-cancel-btn'); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const closeModal = () => modalContainer.remove(); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â confirmBtn.onclick = () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (onConfirm) onConfirm(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â closeModal(); 
 Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â if (cancelBtn) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â cancelBtn.onclick = () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (onCancel) onCancel(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â closeModal(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â startFlashcardSession(type) { 
 Â  Â  Â  Â  Â  Â  Â  Â if (type === 'structure') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("TÃ­nh nÄƒng sáº¯p ra máº¯t", "Há»c flashcard cho cáº¥u trÃºc cÃ¢u hiá»‡n Ä‘ang Ä‘Æ°á»£c phÃ¡t triá»ƒn. Vui lÃ²ng quay láº¡i sau."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderHeader(); 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentFlashcard.items = this.shuffleArray([...this.state.wordList]); 
 Â  Â  Â  Â  Â  Â  Â  Â if (this.state.currentFlashcard.items.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("ThÃ´ng bÃ¡o", "KhÃ´ng cÃ³ tá»« vá»±ng Ä‘á»ƒ há»c báº±ng flashcard."); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentFlashcard.index = 0; 
 Â  Â  Â  Â  Â  Â  Â  Â this.renderFlashcardViewer(); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â renderFlashcardViewer() { 
 Â  Â  Â  Â  Â  Â  Â  Â this.DOM.main.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-4 sm:p-6 fade-in"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div style="height: 70vh; max-width: 800px; margin: 0 auto; display: flex; flex-direction: column;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-end items-center mb-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="card-counter" class="font-semibold text-text-secondary"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div style="flex-grow: 1; display: flex; align-items: center; justify-content: center;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flashcard" id="flashcard" style="width: 100%; height: 100%; max-height: 400px; cursor: pointer;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flashcard-inner"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flashcard-face flashcard-front"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flashcard-face flashcard-back"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-between items-center p-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="prev-card-btn" class="cta-btn secondary !rounded-full !w-14 !h-14 text-xl"><i class="fas fa-arrow-left"></i></button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-text-secondary hidden sm:block">Báº¥m vÃ o tháº» Ä‘á»ƒ láº­t</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="next-card-btn" class="cta-btn secondary !rounded-full !w-14 !h-14 text-xl"><i class="fas fa-arrow-right"></i></button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`; 
 Â  Â  Â  Â  Â  Â  Â  Â this.updateFlashcardView(); 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('prev-card-btn').addEventListener('click', () => this.navigateCard(-1)); 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('next-card-btn').addEventListener('click', () => this.navigateCard(1)); 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('flashcard').addEventListener('click', e => { if (!e.target.closest('.audio-btn')) e.currentTarget.classList.toggle('is-flipped'); }); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â updateFlashcardView() { 
 Â  Â  Â  Â  Â  Â  Â  Â const { items, index } = this.state.currentFlashcard; 
 Â  Â  Â  Â  Â  Â  Â  Â const item = items[index]; 
 Â  Â  Â  Â  Â  Â  Â  Â const card = document.getElementById('flashcard'); 
 Â  Â  Â  Â  Â  Â  Â  Â if (!item || !card) return; 

 Â  Â  Â  Â  Â  Â  Â  Â card.classList.remove('is-flipped'); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â setTimeout(() => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const front = card.querySelector('.flashcard-front'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const back = card.querySelector('.flashcard-back'); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const audioBtnHTML = item.audioUrl ? `<button class="audio-btn" data-audio-url="${item.audioUrl}"><i class="fas fa-volume-up"></i></button>` : ''; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â front.innerHTML = `${audioBtnHTML}<div class="flashcard-word">${item.word}</div>`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â back.innerHTML = `${audioBtnHTML}<div class="flashcard-meaning">${item.meaning}</div><p class="flashcard-pronunciation">${item.pronunciation || ''} <span class="mx-2">&bull;</span> ${item.type || ''}</p><p class="flashcard-example">"${item.generated_tasks?.basic_example || ''}"</p>`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â card.querySelectorAll('.audio-btn').forEach(btn => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â btn.addEventListener('click', (e) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.stopPropagation(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.playAudio(e.currentTarget.dataset.audioUrl); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â }, 150); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('card-counter').textContent = `${index + 1} / ${items.length}`; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â navigateCard(direction) { 
 Â  Â  Â  Â  Â  Â  Â  Â const { items } = this.state.currentFlashcard; 
 Â  Â  Â  Â  Â  Â  Â  Â const newIndex = this.state.currentFlashcard.index + direction; 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.currentFlashcard.index = (newIndex + items.length) % items.length; 
 Â  Â  Â  Â  Â  Â  Â  Â this.updateFlashcardView(); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â playAudio(url) { 
 Â  Â  Â  Â  Â  Â  Â  Â if (!url) return; 
 Â  Â  Â  Â  Â  Â  Â  Â const audio = new Audio(url); 
 Â  Â  Â  Â  Â  Â  Â  Â audio.play().catch(e => console.error("Audio play failed:", e)); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â async handleReportSubmission(reportType) { 
 Â  Â  Â  Â  Â  Â  Â  Â const item = this.state.currentPractice.items[this.state.currentPractice.index]; 
 Â  Â  Â  Â  Â  Â  Â  Â if (!item) return; 

 Â  Â  Â  Â  Â  Â  Â  Â const result = await this.showReportModal(reportType); 
 Â  Â  Â  Â  Â  Â  Â  Â if (!result.confirmed) return; 

 Â  Â  Â  Â  Â  Â  Â  Â const issueId = `${this.state.testData.id}_${item.id}_${item.exerciseType}`; 
 Â  Â  Â  Â  Â  Â  Â  Â const issueRef = doc(this.db, "test_issues", issueId); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const questionContainer = this.DOM.main.querySelector('#question-container'); 
 Â  Â  Â  Â  Â  Â  Â  Â const renderedQuestionHTML = questionContainer ? questionContainer.innerHTML : '<em>KhÃ´ng thá»ƒ táº£i ná»™i dung cÃ¢u há»i.</em>'; 

 Â  Â  Â  Â  Â  Â  Â  Â try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await runTransaction(this.db, async (transaction) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const issueDoc = await transaction.get(issueRef); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const reporterInfo = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â studentId: this.state.studentId, studentName: this.state.studentName, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â comment: result.comment, category: result.category, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â reportedAt: new Date() 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!issueDoc.exists()) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const newIssueData = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â testId: this.state.testData.id, testTitle: this.state.testData.title, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â itemId: item.id, itemWord: item.word, questionType: item.exerciseType, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â questionData: item, renderedQuestionHTML: renderedQuestionHTML, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â status: 'open', lastReportedAt: serverTimestamp(), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â reports: [reporterInfo] 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â transaction.set(issueRef, newIssueData); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â transaction.update(issueRef, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â reports: arrayUnion(reporterInfo), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â lastReportedAt: serverTimestamp(), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â status: 'open' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("ThÃ nh cÃ´ng", "BÃ¡o cÃ¡o cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n giÃ¡o viÃªn."); 
 Â  Â  Â  Â  Â  Â  Â  Â } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.error("Lá»—i khi gá»­i bÃ¡o cÃ¡o:", error); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("Lá»—i", "KhÃ´ng thá»ƒ gá»­i bÃ¡o cÃ¡o. Vui lÃ²ng thá»­ láº¡i."); 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â showReportModal(reportType) { 
 Â  Â  Â  Â  Â  Â  Â  Â return new Promise(resolve => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const isError = reportType === 'error'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const title = isError ? 'BÃ¡o cÃ¡o lá»—i Ä‘á»' : 'YÃªu cáº§u giáº£i thÃ­ch'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let contentHTML = isError 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ? `<p class="text-text-secondary mb-4">Vui lÃ²ng chá»n loáº¡i lá»—i báº¡n gáº·p pháº£i:</p><div class="report-category-group space-y-2"><div><input type="radio" name="error-category" value="Lá»—i chÃ­nh táº£" id="cat-typo" checked><label for="cat-typo">Lá»—i chÃ­nh táº£</label></div><div><input type="radio" name="error-category" value="ÄÃ¡p Ã¡n Ä‘Ãºng bá»‹ sai" id="cat-wrong-answer"><label for="cat-wrong-answer">ÄÃ¡p Ã¡n Ä‘Ãºng bá»‹ sai</label></div><div><input type="radio" name="error-category" value="CÃ¢u há»i khÃ´ng rÃµ rÃ ng" id="cat-unclear"><label for="cat-unclear">CÃ¢u há»i khÃ´ng rÃµ rÃ ng</label></div><div><input type="radio" name="error-category" value="Lá»—i ká»¹ thuáº­t" id="cat-tech"><label for="cat-tech">Lá»—i ká»¹ thuáº­t</label></div></div>` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : `<p class="text-text-secondary mb-4">Ghi chÃº cá»§a báº¡n sáº½ Ä‘Æ°á»£c gá»­i tá»›i giÃ¡o viÃªn Ä‘á»ƒ Ä‘Æ°á»£c giáº£i Ä‘Ã¡p.</p>`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â contentHTML += `<textarea id="report-comment-input" placeholder="ThÃªm ghi chÃº (khÃ´ng báº¯t buá»™c)..." rows="3"></textarea>`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal( 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â title, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â contentHTML, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â true, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â () => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const modal = document.getElementById('main-modal'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const selectedCategory = isError ? (modal.querySelector('input[name="error-category"]:checked')?.value || 'KhÃ¡c') : 'YÃªu cáº§u giáº£i thÃ­ch'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const comment = modal.querySelector('#report-comment-input').value; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â resolve({ confirmed: true, category: selectedCategory, comment: comment }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â () => resolve({ confirmed: false }), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "Gá»­i", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "Há»§y" 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ); 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â renderGuideModal() { 
 Â  Â  Â  Â  Â  Â  Â  Â const rules = this.CONFIG.RULES; 
 Â  Â  Â  Â  Â  Â  Â  Â let message = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="space-y-8 text-left"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="guide-section"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3><i class="fas fa-scroll mr-3"></i>Quy Táº¯c Chung</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="space-y-4"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="guide-rule"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="font-bold text-lg text-light">Má»Ÿ KhÃ³a Level</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-text-secondary">HoÃ n thÃ nh <strong class="text-white">${rules.UNLOCK_THRESHOLD * 100}%</strong> sá»‘ bÃ i táº­p cá»§a má»™t level Ä‘á»ƒ tá»± Ä‘á»™ng má»Ÿ khÃ³a level tiáº¿p theo.</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="guide-rule"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="font-bold text-lg text-light">Kiá»ƒm Tra VÆ°á»£t Cáº¥p</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-text-secondary">YÃªu cáº§u Ä‘á»ƒ qua lÃ  <strong class="text-white">${rules.PROFICIENCY_TESTS[1].passMark * 100}%</strong>. Báº¡n cÃ³ tá»‘i Ä‘a <strong class="text-white">${rules.PROFICIENCY_TESTS[1].maxAttempts}</strong> láº§n thá»­ cho má»—i level.</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul class="list-disc list-inside text-text-secondary mt-2 space-y-1"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><strong class="text-white">Level 1:</strong> LuÃ´n cÃ³ sáºµn.</li> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><strong class="text-white">Level 2:</strong> Má»Ÿ khÃ³a khi hoÃ n thÃ nh <strong class="text-white">${rules.PROFICIENCY_TEST_UNLOCK[2] * 100}%</strong> bÃ i táº­p Level 2.</li> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><strong class="text-white">Level 3:</strong> Má»Ÿ khÃ³a khi hoÃ n thÃ nh <strong class="text-white">${rules.PROFICIENCY_TEST_UNLOCK[3] * 100}%</strong> bÃ i táº­p Level 3.</li> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </ul> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="guide-rule"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="font-bold text-lg text-light">BÃ i Kiá»ƒm Tra Cuá»‘i Ká»³</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-text-secondary">Má»Ÿ khÃ³a khi tiáº¿n Ä‘á»™ tá»•ng quÃ¡t Ä‘áº¡t <strong class="text-white">${rules.FINAL_TEST_UNLOCK_THRESHOLD * 100}%</strong>.</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${Object.keys(this.CONFIG.LEVELS).map(levelKey => this.getGuideLevelSectionHTML(levelKey)).join('')} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â  Â  Â this.showModal("HÆ°á»›ng Dáº«n & Quy Táº¯c", message, false, null, null, 'ÄÃ£ hiá»ƒu', null, 'max-w-4xl'); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('main-modal').querySelectorAll('button[data-guide-type]').forEach(btn => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â btn.addEventListener('click', e => this.renderGuideExampleModal(e.currentTarget.dataset.guideType)); 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â getGuideLevelSectionHTML(levelKey) { 
 Â  Â  Â  Â  Â  Â  Â  Â const levelNum = parseInt(levelKey); 
 Â  Â  Â  Â  Â  Â  Â  Â const levelConfig = this.CONFIG.LEVELS[levelNum]; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â return ` 
 Â  Â  Â  Â  Â  Â  Â  Â <div class="guide-section mt-8"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3><i class="fas fa-layer-group mr-3"></i>Level ${levelNum}: ${levelConfig.name}</h3> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-text-secondary mb-6">CÃ¡c dáº¡ng bÃ i táº­p cÃ³ trong level nÃ y:</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex flex-wrap gap-3"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${levelConfig.tasks.map(taskType => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO[taskType]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return `<button data-guide-type="${taskType}" class="cta-btn secondary !rounded-lg !text-sm !py-2 !px-4"><i class="${info.icon} mr-2"></i> ${info.name}</button>`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }).join('')} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â </div> 
 Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â }, 

 Â  Â  Â  Â  Â  Â renderGuideExampleModal(exerciseType) { 
 Â  Â  Â  Â  Â  Â  Â  Â const info = this.EXERCISE_INFO[exerciseType]; 
 Â  Â  Â  Â  Â  Â  Â  Â const suitableItem = this.state.wordList.find(item => this.isTaskAvailable(item, exerciseType)); 

 Â  Â  Â  Â  Â  Â  Â  Â if (!suitableItem) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showModal("KhÃ´ng cÃ³ dá»¯ liá»‡u", `Hiá»‡n táº¡i chÆ°a cÃ³ dá»¯ liá»‡u phÃ¹ há»£p Ä‘á»ƒ táº¡o vÃ­ dá»¥ cho dáº¡ng bÃ i: "${info.name}".`); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; 
 Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â suitableItem.exerciseType = exerciseType; 
 Â  Â  Â  Â  Â  Â  Â  Â const renderFunction = this[`get${exerciseType}HTML`]; 
 Â  Â  Â  Â  Â  Â  Â  Â if (typeof renderFunction !== 'function') return; 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const exampleHTML = renderFunction.call(this, suitableItem, true); 

 Â  Â  Â  Â  Â  Â  Â  Â this.showModal( 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `HÆ°á»›ng dáº«n: ${info.name}`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `<p class="text-text-secondary mb-6 text-left">${info.desc}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-bg-dark p-4 rounded-lg border border-glass-border"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="font-bold mb-3 text-left">VÃ­ dá»¥ tÆ°Æ¡ng tÃ¡c:</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="guide-question-container">${exampleHTML}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="guide-feedback-container" class="mt-4"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â false, null, null, 'ÄÃ³ng', null, 'max-w-2xl' 
 Â  Â  Â  Â  Â  Â  Â  Â ); 
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â const guideContainer = document.getElementById('guide-question-container'); 
 Â  Â  Â  Â  Â  Â  Â  Â this.attachPracticeEventListeners(suitableItem, guideContainer, true); 
 Â  Â  Â  Â  Â  Â }, 
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â getAllTasksForLevel(level) { 
 Â  Â  Â  Â  Â  Â  Â  Â const tasksForLevel = this.CONFIG.LEVELS[level].tasks; 
 Â  Â  Â  Â  Â  Â  Â  Â const allLevelTasks = []; 
 Â  Â  Â  Â  Â  Â  Â  Â this.state.wordList.forEach(word => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tasksForLevel.forEach(taskType => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (this.isTaskAvailable(word, taskType)) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â allLevelTasks.push({ ...word, exerciseType: taskType, taskUID: `${word.id}::${taskType}` }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â return allLevelTasks; 
 Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â }; 

 Â  Â  Â  Â document.addEventListener('DOMContentLoaded', () => App.init()); 
 Â  Â </script> 
</body> 
</html>
